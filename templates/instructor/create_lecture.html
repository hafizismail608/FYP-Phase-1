{% extends 'base.html' %}

{% block title %}Upload New Lecture{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h2>Upload New Lecture</h2>
            <a href="{{ url_for('instructor.lectures') }}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i> Back to Lectures</a>
            
            <!-- Alert Container -->
            <div id="alert-container" class="mt-3"></div>
            
            <!-- File Info Container -->
            <div id="file-info" class="mt-3"></div>
            
            <!-- Upload Progress -->
            <div id="upload-progress" class="mt-3" style="display: none;">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-cloud-upload-alt"></i> Uploading Video</h5>
                        <div class="progress mb-2">
                            <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p id="progress-text" class="mb-0 text-muted">Preparing upload...</p>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-body">
                    <form id="lecture-upload-form" method="post" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                
                <div class="mb-3">
                    {{ form.title.label(class="form-label") }}
                    {{ form.title(class="form-control" + (" is-invalid" if form.title.errors else "")) }}
                    {% if form.title.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.title.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else ""), rows=4) }}
                    {% if form.description.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.description.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    {{ form.course_id.label(class="form-label") }}
                    {{ form.course_id(class="form-select" + (" is-invalid" if form.course_id.errors else "")) }}
                    {% if form.course_id.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.course_id.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    {{ form.video.label(class="form-label") }}
                    {{ form.video(class="form-control" + (" is-invalid" if form.video.errors else ""), accept="video/*") }}
                    <small class="form-text text-muted">Supported formats: MP4, WebM, MOV (Max size: 500MB)</small>
                    {% if form.video.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.video.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    {{ form.thumbnail.label(class="form-label") }}
                    {{ form.thumbnail(class="form-control" + (" is-invalid" if form.thumbnail.errors else ""), accept="image/*") }}
                    <small class="form-text text-muted">Optional. If not provided, a thumbnail will be generated from the video.</small>
                    {% if form.thumbnail.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.thumbnail.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="mb-3 form-check">
                    {{ form.is_published(class="form-check-input" + (" is-invalid" if form.is_published.errors else "")) }}
                    {{ form.is_published.label(class="form-check-label") }}
                    {% if form.is_published.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.is_published.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="d-grid gap-2">
                    <button id="submit-button" type="submit" class="btn btn-primary">Upload Lecture</button>
                </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-info-circle"></i> Upload Guidelines</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> Maximum file size: 500MB</li>
                        <li><i class="fas fa-check text-success"></i> Supported formats: MP4, WebM, OGG, MOV, AVI, MKV</li>
                        <li><i class="fas fa-check text-success"></i> Recommended resolution: 1080p or higher</li>
                        <li><i class="fas fa-check text-success"></i> Auto-generated subtitles included</li>
                        <li><i class="fas fa-check text-success"></i> Thumbnail auto-generated from video</li>
                    </ul>
                    
                    <div class="alert alert-info mt-3">
                        <small><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Large files will be uploaded in chunks with real-time progress tracking for a better experience.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/upload-progress.js') }}"></script>
{% endblock %}